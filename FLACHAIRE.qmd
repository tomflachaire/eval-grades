---
title: "eval-grades"
author: "Tom Flachaire"
format: html
---

Here is the link of my github : https://github.com/tomflachaire/eval-grades.git

# 1. Introduction

## 1.1 Study organisation

### Question 1 

```{r}
here::i_am("eval-grades.Rproj")
library(ggplot2)
library(dplyr)
library(readr)
library(knitr)
library(here)
library(lubridate)
```

```{r}
courses <- read_csv(here("courses.csv"))
```

### Question 2

```{r}
courses %>%
  arrange(course) %>%  # Tri alphabétique
  rename(
    "course name" = course,
    "identifier" = course_id,
    "module" = module,
    "number of exams" = nb_grades   # colonne réelle de ton fichier
  ) %>%
  kable(caption = "Course description table")
```

## 1.2 Students

### Question 3

```{r}
students <- read_csv(here("students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(format = ""),
    sex = col_factor()
  )
)

str(students)
```

## 1.3 Grades

### Question 4 

```{r}
grades <- read_delim(here("grades.csv"),
  delim = ";",      
  na = "$",         
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

str(grades)
```

# 2. Student population analysis

### Question 5 

```{r}
students %>%
  count(group) %>%
  ggplot(aes(x = factor(group), y = n)) +
  geom_col(fill = "steelblue") +
  labs(title = "Number of Students per Group", x = "Group", y = "Students")
```

### Question 6

```{r}
students %>%
  count(group, sex) %>%
  ggplot(aes(x = factor(group), y = n, fill = sex)) +
  geom_col() +
  labs(title = "Gender Balance per Group", x = "Group", y = "Students")
```

### Question 7 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "steelblue", color = "white") +
  labs(title = "Distribution of Student Ages", x = "Age", y = "Number of Students")
```

### Question 8 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  group_by(group) %>%
  summarise(median_age = as.integer(median(age))) %>%
  kable(caption = "Median age of students per group")
```

### Question 9 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  group_by(group) %>%
  slice_max(order_by = age, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  select(id, sex, age, group) %>%
  arrange(desc(age)) %>%
  kable(caption = "Oldest student in each group")
```

# 3. Simple grade analysis

### Question 10 

```{r}
n_grades <- grades %>%
  filter(!is.na(grade)) %>%
  nrow()

cat("The data set contains", n_grades, "grades.") # to display
```

### Question 11

```{r}
grades %>%
  filter(course_id == 7) %>%  # Historical Archaeology and Antiquarian Studies
  left_join(students, by = "id") %>%
  group_by(group) %>%
  summarise(avg_grade = mean(grade, na.rm = TRUE)) %>%
  ggplot(aes(x = factor(group), y = avg_grade)) +
  geom_col(fill = "blue") +
  labs(title = "Average Grade in Historical Archaeology per Group",
       x = "Group", y = "Average Grade")
```

### Question 12 

```{r}
grades %>%
  left_join(courses, by = "course_id") %>%
  ggplot(aes(x = factor(module), y = grade)) +
  geom_boxplot() +
  labs(title = "Grade Distribution by Module",
       x = "Module", y = "Grade")
```

# 4. Attendance analysis

### Question 13

```{r}

# We compute the number of grades per student
grades %>%
  filter(!is.na(grade)) %>%
  group_by(id) %>%
  summarise(n_grades = n()) %>%
  left_join(students, by = "id") %>%
  select(id, group, sex, n_grades) %>%
  slice_head(n = 10) %>%
  kable(caption = "Number of grades per student (first 10 rows)")

# Summary 
grades %>%
  filter(!is.na(grade)) %>%
  group_by(id) %>%
  summarise(n_grades = n()) %>%
  summarise(
    min = min(n_grades),
    max = max(n_grades),
    mean = round(mean(n_grades), 1),
    median = median(n_grades)
  ) %>%
  kable(caption = "Summary of number of grades per student")
```

### Question 14

```{r}
grades %>%
  filter(!is.na(grade)) %>%
  group_by(id) %>%
  summarise(n_grades = n()) %>%
  left_join(students, by = "id") %>%
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_histogram(position = "dodge", binwidth = 1) +
  labs(title = "Distribution of number of grades by sex",
       x = "Grades",
       y = "Students")
```
