---
title: "eval-grades"
author: "Tom Flachaire"
format: html
---

## Question 1 

```{r}
here::i_am("eval-grades.Rproj")
library(ggplot2)
library(dplyr)
library(readr)
library(knitr)
library(here)
library(lubridate)
```

```{r}
courses <- read_csv(here("courses.csv"))
```

## Question 2

```{r}
courses %>%
  arrange(course) %>%  # Tri alphabétique
  rename(
    "course name" = course,
    "identifier" = course_id,
    "module" = module,
    "number of exams" = nb_grades   # colonne réelle de ton fichier
  ) %>%
  kable(caption = "Course description table")
```

## Question 3

```{r}
students <- read_csv(here("students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(format = ""),
    sex = col_factor()
  )
)

str(students)
```

## Question 4 

```{r}
grades <- read_delim(here("grades.csv"),
  delim = ";",      
  na = "$",         
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

str(grades)
```

## Question 5 

```{r}
students %>%
  count(group) %>%
  ggplot(aes(x = factor(group), y = n)) +
  geom_col(fill = "steelblue") +
  labs(title = "Number of Students per Group", x = "Group", y = "Students")
```

## Question 6

```{r}
students %>%
  count(group, sex) %>%
  ggplot(aes(x = factor(group), y = n, fill = sex)) +
  geom_col() +
  labs(title = "Gender Balance per Group", x = "Group", y = "Students")
```

## Question 7 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "steelblue", color = "white") +
  labs(title = "Distribution of Student Ages", x = "Age", y = "Number of Students")
```

## Question 8 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  group_by(group) %>%
  summarise(median_age = as.integer(median(age))) %>%
  kable(caption = "Median age of students per group")
```

## Question 9 

```{r}
students %>%
  mutate(age = round(time_length(today() - birth_date, "year"))) %>%
  group_by(group) %>%
  slice_max(order_by = age, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  select(id, sex, age, group) %>%
  arrange(desc(age)) %>%
  kable(caption = "Oldest student in each group")
```

